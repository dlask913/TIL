## (redis) 레디스 캐싱 전략
> 데이터를 캐싱할 때 사용하는 전략 ( Cache Aside, Write Around ), 캐싱으로 조회 성능 개선을 하기 전 주의사항

<br>

## 데이터를 캐싱할 때 사용하는 전략 ( Cache Aside, Write Around )

### 캐시와 캐싱
- 캐시(Cache) : 원본 저장소보다 빠르게 가져올 수 있는 임시 데이터 저장소
- 캐싱(Caching) : 캐시(임시 데이터 저장소) 에 접근해서 데이터를 빠르게 가져오는 방식

<br>

### Cache Aside (= Look Aside, Lazy Loading) 전략
> 데이터를 조회할 때 주로 사용하는 전략

1. 애플리케이션 → Redis 로 데이터 요청
2. 데이터가 없다면, 애플리케이션 → DB로 데이터 요청
3. DB → 애플리케이션으로 데이터 응답
4. 애플리케이션 → Redis 로 캐시에 데이터 저장

- Redis 로 데이터를 요청했을 때, 캐시에 데이터가 있는 경우 `Cache Hit` 이라고 한다.
- Redis 로 데이터를 요청했을 때, 캐시에 데이터가 없는 경우 `Cache Miss` 라고 한다.
- 즉, 캐시에서 데이터를 확인하고 없다면 DB를 통해 조회해오는 방식을 말한다. 

### Write Around 전략
> Cache Aside 전략과 같이 자주 활용되는 전략으로, 데이터를 어떻게 쓸 지(저장, 수정, 삭제) 에 대한 전략

- 데이터를 저장할 때는 Redis 에 저장하지 않고 DB 에만 저장하는 방식이다.
- 이후 데이터를 조회할 때 레디스에 데이터가 없으면 DB 로부터 데이터를 조회해와 Redis에 저장시켜준다.
- 즉, 쓰기 작업(저장, 수정, 삭제)을 캐시에는 반영하지 않고 DB에만 반영하는 방식을 말한다.

<br>

### Cache Aside, Write Around 전략의 한계점과 해결 방법
#### 1. 캐시된 데이터와 DB 데이터가 일치하지 않을 수 있다. ( 일관성 보장 X )
- Write Around 에 따르면 데이터를 수정할 때 DB 만 업데이트하기 때문에 기존에 저장된 Redis 의 데이터 값과 DB 데이터 값이 다를 수 밖에 없다. 
- 그렇다고 데이터를 수정할 때마다 동시에 업데이트 시키면 성능적으로 느려진다. 
- 데이터 조회 성능 개선 목적으로 Redis 를 쓰는 경우에는 데이터의 일관성을 포기하고 성능 향상을 택했다고 볼 수 있다.
- 장기간 데이터가 일치하지 않는 건 문제가 될 수 있기 때문에 **Redis 의 TTL 기능(만료 시간 설정 기능)** 을 통해 적절한 주기로 데이터를 동기화 시킬 수 있다. → 데이터가 캐시에서 삭제되면 특정 사용자가 조회하는 순간 Cache Miss 가 발생하여 DB 에서 데이터를 캐시에 넣게 된다. 

#### 2. 캐시에 저장할 수 있는 공간이 비교적 작다.
- DB 는 디스크에 저장해서 많은 양을 저장할 수 있지만 캐시는 메모리(RAM) 에 저장하기 때문에 많은 양의 데이터를 저장할 수 없다.
- **TTL 기능(만료 시간 설정 기능)** 을 활용하면 자주 조회하지 않는 데이터가 만료 시간에 의해 데이터가 삭제되기 때문에 캐시의 공간을 효율적으로 쓸 수 있다.


> ※ 캐시를 적용시키기에 적절한 데이터
> - 자주 조회되는 데이터
> - 잘 변하지 않는 데이터
> - 실시간으로 정확하게 일치하지 않아도 되는 데이터

<br>

## 캐싱으로 조회 성능 개선을 하기 전 주의사항
### 데이터 조회 성능을 개선하는 방법
- SQL 튜닝 (★)
- 캐싱 서버 활용 ( Redis 등 )
- 레플리케이션 ( Master/Slave 구조 )
- 샤딩
- DB 스케일업 ( CPU, Memory, SSD 등 하드웨어 업그레이드 )

### SQL 튜닝을 가장 먼저 고려하기 
1. SQL 튜닝을 제외한 나머지 방법은 추가적인 시스템 구축을 해야하기 때문에 금전적, 시간적 비용 및 관리 비용이 늘어난다. → SQL 튜닝은 기존의 시스템 변경 없이 성능을 개선할 수 있다. 
2. SQL 자체가 비효율적으로 작성됐다면 아무리 시스템적으로 성능을 개선하더라도 한계가 있지만 SQL 튜닝을 통해 기본적으로 성능을 향상시킨다면 훨씬 간단한 개선으로 큰 성능 개선 효과를 얻을 수 있다. 

<br>

## 참고
[인프런 - 비전공자도 이해할 수 있는 Redis 입문/실전 (조회 성능 최적화편)](https://inf.run/Pupon)