## (docker) 컨테이너 상태
> 컨테이너 상태와 컨테이너의 Stateless

<br>

## 컨테이너 상태
### Stateless 
- 컨테이너가 실행된 후 발생하는 모든 변경 사항은 컨테이너 레이어에만 존재하며, 컨테이너가 종료되면 변경 사항은 모두 사라진다.
- 컨테이너는 Stateless하기 때문에 쉽게 확장할 수 있으며, 다른 환경에서도 빠르게 배포할 수 있다.
- 컨테이너의 소프트웨어 버전이 변경되거나 설정이 변경될 경우, 새로운 버전의 이미지를 만들어서 배포해야 한다. 

### Pet & Cattle
- Pet : 전통적인 서버 관리 방법론으로, 하나의 서버를 특별히 관리하고 보호한다.
- Cattle : 컨테이너를 기반으로 한 서버 관리 방법론으로, 서버를 일회용으로 다루고 쉽게 교체하며 상태를 최대한 외부로 분리한다.
- Pet vs Cattle

| 기준      | Pet                  | Cattle             |
| ------- | -------------------- | ------------------ |
| 방식      | 전통적, VM 방식           | 컨테이너 방식            |
| 이름      | 고유한 이름을 가짐           | 랜덤한 일련번호 생성        |
| 문제 발생 시 | 문제 해결 또는 복구 시도       | 삭제 후 새로 생성         |
| 상태      | 상태가 내부에 저장           | 상태 없음, 필요 시 외부 마운트 |
| 교체      | 교체가 어려움              | 쉽게 교체              |
| 적용 사례   | Monolithic, OnPremis | MSA, WEBAPP        |

<br>

## 컨테이너의 Stateless
### 특징
- **불변성(Immutability)** : 한 번 지정된 컨테이너 이미지는 변경되지 않는다.
- **새로운 설정이나 패치**가 필요할 경우, **새로운 이미지를 생성**해야 한다.
- 컨테이너는 언제든지 새로운 컨테이너로 대체될 수 있으며, **환경에 무관하게 실행** 가능하다. ( 개발, 운영, 테스트 환경 등 )
- 동일한 컨테이너를 여러 개 생성하여 **트래픽에 유연하게 대응**할 수 있다.
- 장애가 발생할 경우, **새로운 컨테이너를 빠르게 시작**하여 복구할 수 있다.

### 제약
- 데이터를 영구적으로 저장하기 위해서는 데이터베이스 서버 사용이 필수이다. 상태가 없기 때문에 **저장 및 공유가 필요한 데이터는 무조건 외부에 저장**해야 한다. 
- 사용자 **세션 정보나 캐시 같은 정보를 캐시 서버나 쿠키 ( 외부 저장소 )** 를 통해 관리한다. 파일이나 메모리 ( 내부 ) 에 저장하지 않아야 한다. 
- **동일한 요청은 항상 동일한 결과**를 제공해야 한다. 
- 환경 변수나 구성 파일을 통해 **설정을 외부에서 주입**할 수 있어야 한다. 이를 통해 다양한 환경에서 컨테이너 이미지를 활용할 수 있다. 

<br>

## 참고
[인프런 - 개발자를 위한 쉬운 도커](https://inf.run/wHHR8) 