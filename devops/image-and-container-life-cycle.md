## (docker) 이미지와 컨테이너 라이프사이클
> 이미지와 이미지 메타 데이터, 컨테이너의 라이프사이클

<br>

## 이미지
- 특정 시점의 파일시스템(디렉터리) 를 저장한 압축 파일
- 소프트웨어 뿐 아니라 소프트웨어가 실행하기 위해서 필요한 모든 요소가 압축되어 있다.
- 윈도우의 백업, 가상머신의 스냅샷 기능과 유사하나 사이즈가 훨씬 작다.
> ※ 서버에서 프로그램을 실행하기 위해서 필요한 3가지
> 1. OS : 애플리케이션 실행에 필요한 기본 시스템 파일
> 2. 구성 요소 : 애플리케이션 실행에 필요한 언어, 라이브러리 및 설정 구성 ( Java, Lib, .. )
> 3. 프로그램 : 개발자가 개발한 애플리케이션 실행 파일 또는 다운로드 받은 소프트웨어

→ 애플리케이션을 실행할 수 있는 모든 환경이 준비되어 있는 압축 파일
### 이미지 메타데이터
> 메타데이터 : 데이터에 대한 데이터

-  이미지가 실제로 압축된 데이터라면, 메타데이터는 이 이미지에 대한 정보를 기술하는 데이터를 말한다. = 이미지 파일 데이터에 대한 데이터
- 이미지 = 실제 압축된 파일 + 이 파일의 정보가 저장되어 있는 메타데이터로 구성
- 덮어쓰기 가능 ( 이미지가 아니라 실행하는 시점에서 컨테이너의 메타데이터만 변경 가능)
```shell
$ docker run --name [컨테이너명] [이미지명] [덮어쓰기 할 명령어] # CMD 덮어쓰기
$ docker run --name [컨테이너명] --env [덮어쓰기 할 key-value] [이미지명] # ENV 덮어쓰기
```

### 이미지 세부 정보 조회
: 이미지의 메타데이터를 JSON 형식으로 반환하여 이미지 구성, 레이어 정보, 환경 변수, 기본 실행 명령어(CMD) 등을 확인할 수 있다.
```shell
$ docker image inspect [이미지명]
```
- 주요 구성 요소 
1. ENV : 애플리케이션이 사용하는 환경 설정 값 ( key-value 형태 ), 소프트웨어가 실행 시 참조할 설정 정보
2. CMD : 컨테이너 실행 시 프로세스 실행 명령어 지정
- 실행 예시 <br>
![docker image inspect nginx](https://github.com/dlask913/TIL/assets/79985588/a36d2c3b-059f-4198-931d-ec5a49ec35fe)

<br>

## 컨테이너의 라이프사이클
: docker ps 명령어를 통해 Status 를 확인할 수 있다. 
1. **생성 ( Created )** : 이미지를 통해 컨테이너 생성, 컨테이너를 실행하기 위한 격리된 공간이 만들어지는 상태  ( 실행 전이므로 CPU, 메모리 사용 X )
```shell
$ docker create [옵션] [이미지명]
```
2. **실행 ( Running/Up )** : 컨테이너 내에서 정상적으로 프로세스가 실행 중인 상태 ( CPU, 메모리 사용 O )
```shell
$ docker start [컨테이너명]
$ docker restart [컨테이너명] # 실행중인 경우 10초 뒤 재시작
```
> docker run 명령을 사용하면 생성 + 실행

 3. **일시정지 ( Paused )** : 컨테이너에서 실행 중인 모든 프로세스가 일시 중지된 상태 → 현재의 상태를 모두 메모리에 저장 ( CPU X, 메모리 O )
```shell
$ docker pause [컨테이너명]
$ docker unpause [컨테이너명] # 일시정지했던 시점부터 재시작
```
4. **종료 ( Stopped/Exited )** : 컨테이너에서 실행 중인 프로세스를 완전히 중단시킨 상태 ( CPU, 메모리 X )
```shell
$ docker stop [컨테이너명] # 실행중인 경우 10초 뒤 종료
```
5. **삭제 ( Deleted )** : 컨테이너 삭제 상태
```shell
$ docker rm [컨테이너명]
$ docker rm -f [컨테이너명] # 실행중인 컨테이너 삭제
```

<br>

## 도커 명령어 정리
- docker image inspect 이미지명 : 이미지의 세부 정보 조회
- docker container inspect 컨테이너명 : 컨테이너의 세부 정보 조회
- docker run 이미지명 ( 실행명령 ) : 컨테이너 실행 시 메타데이터의 cmd 덮어쓰기
- docker run --env KEY=VALUE 이미지명 : 컨테이너 실행 시 메타데이터의 env 덮어쓰기
- docker logs 컨테이너명 : 컨테이너의 로그 조회

<br>

## 참고
[인프런 - 개발자를 위한 쉬운 도커](https://inf.run/wHHR8) 
