# 카프카 컨슈머 옵션들
> Java library 기준 컨슈머 필수&선택 옵션들

<br>

## 컨슈머 필수 옵션
> 설정된 default 값이 없는 옵션들을 말한다.

- bootstrap.servers: 프로듀서가 데이터를 전송할 대상 카프카 클러스터에 속한 브로커들의 호스트이름: 포트를 1개 이상 작성한다. 2개 이상을 입력하여 일부 브로커에 이슈가 발생하더라도 접속에 이슈가 없도록 설정할 수 있다. 
- key.deserializer: 레코드의 메시지 키를 역직렬화하는 클래스를 지정한다.
- value.deserializer: 레코드의 메시지 값을 역직렬화하는 클래스를 지정한다. 

### key, value 타입이 맞지 않을 때 문제점
- key, value 타입이 브로커에서 전송한 타입이랑 컨슈머에서 받는 타입이 같지 않으면 역직렬화 오류가 발생하여 메시지를 읽지 못한다.
- Float와 String 처럼 타입이 다를 경우, 원하는 값이 나오지 않으며 보통은 String 으로 직렬화/역직렬화해서 JSON 데이터를 많이 처리하고는 한다.

<br>

## 컨슈머 선택 옵션
> 설정된 default 값이 있는 옵션들을 말한다.

- group.id : 컨슈머 그룹 아이디를 지정한다. subscribe() 로 토픽을 구독하여 사용할 때는 필수로 넣어야 하며, 기본값은 null 이다. 
- auto.offset.reset : 컨슈머 그룹이 특정 파티션을 읽을 때 저장된 컨슈머 오프셋이 없는 경우 ( 커밋을 하지 않은 경우 ) 어느 오프셋부터 읽을 지 선택한다. 오프셋이 있다면 이 옵션값은 무시되며 기본값은 latest 이다.
- enable.auto.commit : 자동 커밋으로 할 지 수동 커밋으로 할 지 선택한다. 기본 값은 true
- auto.commit.interval.ms : 자동 커밋일 경우 오프셋 커밋 간격을 지정한다. 기본값은 5000(5초) 이다. 
- max.poll.records: poll() 를 통해 반환되는 레코드 개수를 지정한다. 기본값은 500 이다. 
- session.timeout.ms : 컨슈머가 브로커와 연결이 끊기는 최대 시간이다. 기본값은 10000(10초) 이다.  → 이후 리밸런싱 발생
- heartbeat.interval.ms : 하트비트를 전송하는 시간 간격이다. 기본값은 3000(3초) 이다.  → 이후 리밸런싱 발생
- max.poll.interval.ms : poll() 를 호출하는 간격의 최대 시간이다. 기본값은 300000(5분) 이다.  → 이후 리밸런싱 발생
- isolation.level : 트랜잭션 프로듀서가 레코드를 트랜잭션 단위로 보낼 경우 사용한다. 

> ※ heartbeat.inverval.ms 와 session.timeout.ms <br>
> - 네트워크 환경이 불안정하거나 자주 끊기는 경우, 위 값들을 충분히 큰 값으로 설정하여 컨슈머가 오작동하는 것으로 잘못 감지되지 않도록 해야 한다.

<br>

## auto.offset.reset
> 컨슈머 그룹이 특정 파티션을 읽을 때 저장된 오프셋이 없으면, 어느 오프셋부터 읽을지를 지정한다. <br> 오프셋이 있는 경우 이 설정은 무시되며, 기본 값은 latest 이다. 

- latest ( default value ) : 가장 높은 ( 가장 최근에 넣은 ) 오프셋부터 읽기 시작한다.
- earliest : 가장 낮은 ( 가장 오래전에 넣은 ) 오프셋부터 읽기 시작한다.
- none : 컨슈머 그룹이 커밋한 기록이 있는 지 찾아본다. 만약 커밋 기록이 없다면 오류를 반환하고, 있다면 기존 커밋 기록 이후 오프셋부터 읽기 시작한다. 


<br>

## 참고
[아파치 카프카 애플리케이션 프로그래밍](https://inf.run/uCwV5)