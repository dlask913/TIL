# 카프카 클러스터 운영
> 카프카 클러스터를 운영하는 여러가지 방법 ( 온프레미스, SaaS형 ) <br> 직접 서버에 설치하고 운영하는 것이 가장 기본적인 방법이나 이를 위해서는 노하우가 필요하기 때문에 수많은 시행착오를 거쳐야 한다. <br>이러한 운영상 시행착오를 줄이면서 최고의 카프카 클러스터를 빠르게 설치하여 운영하기 위해 SaaS 를 도입할 수 있다. 

<br>

## 오픈 소스 카프카를 직접 설치하여 운영하는 경우 ( IaaS 또는 온프레미스 환경 )
- 메모리 : 32GB 머신에 힙 메모리 6GB 로 설정. 나머지는 OS의 페이지 캐시 영역으로 활용
- CPU : 24 core 머신 사용. 만약 SSL 과 같은 보안 설정 사용할 경우 더 높은 사용 필요
- 디스크 : RAID 10 으로 설정된 디스크 사용. 데이터 처리량에서 이슈가 발생하기 때문에 NAS 는 사용하면 안됨.
- 네트워크 : 사용하는 데이터 통신량에 따라 다름
- 파일시스템 : XFS 또는 ext4

### 개발용 카프카 클러스터
- 브로커 개수 : 최소 3개 ~ 5개 + α
- 메모리 : 16 GB ( heap memory 6GB )
- CPU : 16 core
- 디스크 : 사용량에 따라 달라짐

### 상용 환경 카프카 클러스터
- 브로커 개수 : 10개 + α
- 메모리 : 32 GB ( heap memory 6GB )
- CPU : 24 core
- 디스크 : 사용량에 따라 달라짐

<br>

## SaaS 형 아파치 카프카
### 컨플루언트 ( CONFLUENT )
- 카프카에 대한 개념을 최초로 생각하고 아키텍처를 제안, 개발한 인물인 제이 크랩스와 그의 동료들이 설립한 회사
- 오픈 소스로 공개하고 관리하고 있는 스키마 레지스트리, ksqlDB 등과 같은 소스 코드들이 있다.

**1. 컨플루언트 클라우드**
- 클라우드 기반 카프카 클러스터 ( SaaS )
- 요구사항에 따라 자동으로 늘려주는 클러스터 리소스 제공
- GCP, AWS 등 클러스터 설치 위치 지정( 리전 단위 ) 가능
- 120 개가 넘는 커넥터, ksqlDB, 스키마 레지스트리 서비스 제공
- 99.95% SLA
- 엔터프라이즈 수준의 보안 수준 제공 ★
- 데이터 적재 제한 없음

**2. 컨플루언트 플랫폼**
- 온프레미스 기반 설치형 카프카 클러스터
- 서버를 내부에서 발급하여 직접 설치
- 필요에 따라 컨플루언트 팀에서 지원, 학습 제공
- 단계별 스토리지 기능( Tiered-storage ) 제공
- GUI 기반 모니터링 시스템 제공 ★

### AWS MSK ( Managed Streaming for Apache Kafka )
- 완전관리형의 고가용성 Apache Kafka (오픈소스) 서비스를 통해 안전하게 데이터를 스트리밍
- 카프카 클러스터를 생성, 업데이트, 삭제 등과 같은 운용 요소를 대시보드를 통해 제공
- TLS 인증 보안 설정 가능
- 아파치 카프카 버전 선택 가능 ( 서비스 연동 이슈를 발생시키지 않게 함 )

<br>

## SaaS형 아파치 카프카 장점과 단점
### 장점
**1. 인프라 관리의 효율화**
- 상용 환경에서 최소 3대 이상의 서버 ( 브로커 ) 로 운영한다. 개발자 입장에서는 이 3대 이상의 서버를 모니터링 해야하는데 SaaS 를 사용하게 되면 자동으로 관리된다.
- SaaS 가 이슈를 감지하여 신규 장비에 브로커를 실행하여 클러스터를 복구한다.
- SaaS 대시보드에서 브로커 개수만 설정하면 쉽게 스케일 아웃이 가능하다.

**2. 모니터링 대시보드 제공**
- 자동화되어 만들어진 클러스터로부터 운영에 필요한 지표들을 수집하고 그래프로 보여주는 옵션이 제공된다.

**3. 보안 설정**
- 보안 설정이 되지 않은 클러스터의 경우 호스트와 포트 번호만 알면 모든 토픽의 데이터를 가져갈 수 있다. 
- 카프카 브로커는 SSl, SASL, ACL 과 같이 불특정 다수의 침입을 막기 위해 SaaS형 카프카에서는 클러스터 접속 시 보안 설정을 기본으로 제공하고 있다. 
- 클러스터 생성 시 보안 설정을 통해 인가된 사용자만 카프카 클러스터에 접근할 수 있도록 한다.

### 단점
**1. 서비스 사용 비용**
- SaaS 형 카프카에 적용된 금액은 서버만 발급해서 사용하는 비용에 비해 현저히 높다. ( AWS MSK 의 경우 3대의 브로커로 인스턴스들을 구성하여 사용하면 약 120만원 발생 )

**2.  커스터마이징의 제한**
- 직접 운영하게 되면 서버의 최적화 옵션이나 카프카 브로커 옵션 등 사용자 설정이 들어가나, SaaS 는 모든 부분이 자동화되어 있다보니 상세한 설정을 적용하기 어렵다.
- 멀티 클라우드와 하이브리드 클라우드 형태 모두 불가능하다.

**3. 클라우드의 종속성**
- 모든 애플리케이션이 특정 서비스에 종속되어 마이그레이션이 어려워진다.


### SaaS형 카프카를 사용하는 것이 나은 경우
- 노하우가 부족한 상태에서 빠르게 클러스터 인프라를 구축하고 활용해야 할 때

<br>

## 참고
[아파치 카프카 애플리케이션 프로그래밍](https://inf.run/uCwV5) 