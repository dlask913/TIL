# 카프카 활용 아키텍처 사례
> 카카오, 넷플릭스, 라인, 11번가 사례 분석 및 카프카 기술 별 아키텍처 적용 방법 정리

<br>

## 카카오 스마트 메시지 서비스
- 소재최적화와 유저타게팅을 통해 적합한 유저에게 광고 메시지를 개인화 전송하는 서비스
- 사용자에게 흥미가 있는 소재를 최적화하고 적합한 유저에게 타겟팅하여 광고를 선별 전송한다.
### 스마트 메시지의 카프카 스트림즈 활용
> Aggregation 및 Mapping Process 

- 사용자의 반응 로그(imp, click)을 취합하여 저장하고 유저 데이터를 매핑하여 처리하는 용도로 카프카 스트림즈 활용
- 카프카 스트림즈의 groupByKey, windowedBy, aggregate 구문을 통해 1분 로그를 window 취합하여 적재하고 map 구문을 통해 Redis 의 유저 데이터와 결합 처리하는 로직을 수행

<br>

## 넷플릭스 키스톤 프로젝트
![image](https://miro.medium.com/v2/resize:fit:720/format:webp/0*IPlVeq8BVU0aoUY0)

- Fronting Kafka 는 라우팅 용도로 모든 데이터를 수집
- Router ( 자체 스트림 프로세싱, 라우팅 애플리케이션 ) 을 사용하여 Consumer Kafka 는 하둡, 엘라스틱 서치와 같은 데이터베이스로 전달

<br>

## 라인 쇼핑 플랫폼
![image](https://engineering.linecorp.com/wp-content/uploads/2020/10/LINEShopping1.png)

- 시스템 유연성을 개선하고 처리량에 한계를 없애기 위해 카프카를 중앙에 둔 아키텍처 적용
- 카프카 커넥트 도입 및 mongdodb CDC(Change Data Capture) 커넥터 활용 (★)
- 이벤트 기반 데이터 처리로 상품 처리 속도 매우 상승

<br>

## 11번가 주문/결제 시스템 적용 사례 
![image](https://github.com/user-attachments/assets/2a9ee96b-09ff-4009-8665-cbc93d390f51)
*https://deview.kr/2019/schedule/305*

- 데이터베이스의 병목현상을 해소하기 위해 도입
- 카프카를 단일 진실 공급원(Source of Truth) 으로 정의
- 메시지를 Materalized View 로 구축하여 배치 데이터처럼 활용

<br>

## 카프카 기술 별 아키텍처 적용 방법 정리
#### 1. 카프카 커넥트 
- 반복적인 파이프라인을 만들어야할 경우 분산 모드 커넥트를 설치하고 운영
- 가급적 오픈소스 커넥터를 사용하고 필요시 커스텀 커넥터 개발하여 운영
- REST API 와 통신하여 동작할 수 있는 웹 화면을 개발하거나 오픈소스 활용하는 것을 추천
#### 2. 카프카 스트림즈
- 강력한 **stateful**, stateless 프로세싱 기능이 들어 있으므로 카프카 토픽의 데이터 처리 시 활용
#### 3. 카프카 컨슈머, 프로듀서
- 커넥트와 스트림즈로 구현할 수 없거나 단일성 파이프라인, 개발일 경우 컨슈머 또는 프로듀서로 개발

#### 4. 카프카 클러스터
> 카프카 프로듀서 → 카프카 클러스터 ↔ 카프카 스트림즈 or 카프카 커넥트 or 카프카 컨슈머 → 타 서비스 또는 DB

- 프로듀서를 통해 데이터 최초로 유입
- 토픽 기반 데이터 프로세싱은 카프카 스트림즈로 처리
- 반복된 파이프라인은 카프카 커넥트에서 운영
- 단발적인 처리는 컨슈머로 개발

<br>

## 참고
[아파치 카프카 애플리케이션 프로그래밍](https://inf.run/uCwV5)